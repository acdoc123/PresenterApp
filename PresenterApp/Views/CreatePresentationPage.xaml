<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PresenterApp.Views.CreatePresentationPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:PresenterApp.ViewModels"
    Title="Tạo file trình chiếu"
    x:DataType="vm:CreatePresentationViewModel">
    <VerticalStackLayout Padding="10" Spacing="15">

        <Picker
            Title="Chọn chủ đề"
            ItemDisplayBinding="{Binding Name}"
            ItemsSource="{Binding Themes}"
            SelectedItem="{Binding SelectedTheme}" />

        <Picker
            Title="Chọn cấu trúc trình chiếu"
            ItemDisplayBinding="{Binding Name}"
            ItemsSource="{Binding Structures}"
            SelectedItem="{Binding SelectedStructure}" />

        <Line
            Margin="0,10"
            Stroke="LightGray"
            StrokeThickness="1" />
        <ScrollView>

            <Label
                FontAttributes="Bold"
                FontSize="Title"
                Text="Tạo Slide" />

            <CollectionView IsVisible="{Binding IsStructureSelected}" ItemsSource="{Binding StructureComponents}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:PresentationComponentViewModel">
                        <Frame Margin="0,5" Padding="10">
                            <VerticalStackLayout Spacing="5">

                                <HorizontalStackLayout VerticalOptions="Center">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="Large"
                                        Text="{Binding Component.Name}"
                                        VerticalOptions="Center" />
                                    <Button
                                        Margin="10,0,0,0"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:CreatePresentationViewModel}}, Path=AddContentToComponentCommand}"
                                        CommandParameter="{Binding .}"
                                        CornerRadius="20"
                                        FontAttributes="Bold"
                                        FontSize="Large"
                                        HeightRequest="40"
                                        Text="+"
                                        WidthRequest="40" />
                                </HorizontalStackLayout>

                                <CollectionView Margin="20,0,0,0" ItemsSource="{Binding ContentBlocks}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:FlexibleContentBlock">
                                            <Label Padding="5" Text="{Binding ContentEntry.Name}" />
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <VerticalStackLayout IsVisible="{Binding IsStructureSelected, Converter={StaticResource InvertedBoolConverter}}" Spacing="5">

                <Button
                    Command="{Binding AddFreeSlideCommand}"
                    FontAttributes="Bold"
                    Text="+ Thêm Slide" />

                <CollectionView ItemsSource="{Binding FreeSlides}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:FlexibleContentBlock">
                            <Frame Margin="0,2" Padding="5">
                                <Label Text="{Binding ContentEntry.Name}" />
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </VerticalStackLayout>
</ContentPage>